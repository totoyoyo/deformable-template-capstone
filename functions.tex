\documentclass[12pt]{article}

\usepackage{fancyhdr}
\usepackage[hmargin = 1in,vmargin=1in]{geometry}
\usepackage[parfill]{parskip}
\usepackage{breqn}

\begin{document}
yo function:



\begin{dmath*}
  D = \exp\left(\left({P^{2}\cdot 
  \begin{bmatrix}
    1\\
    1
  \end{bmatrix} \cdot 
  \begin{bmatrix}
    1\\
    \vdots\\
    1_{Kg}
  \end{bmatrix}^\top} 
  + {(C_b^{2}\cdot 
  \begin{bmatrix}
    1\\
    1
  \end{bmatrix}
  \cdot 
  \begin{bmatrix}
    1\\
    \vdots\\
    1_{|\Lambda|}
  \end{bmatrix}^\top )^\top} 
  -2\cdot P\cdot C_b^\top \right) \cdot\frac{1}{2\cdot sd_g^2}\right) \cdot B)
\end{dmath*}


\begin{dmath*}
  K_p^\beta= \exp\left(\left({
    (P-D)^{2}\cdot 
  \begin{bmatrix}
    1\\
    1
  \end{bmatrix} \cdot 
  \begin{bmatrix}
    1\\
    \vdots\\
    1_{Kp}
  \end{bmatrix}^\top} 
  + {(C_a^{2}\cdot 
  \begin{bmatrix}
    1\\
    1
  \end{bmatrix}
  \cdot 
  \begin{bmatrix}
    1\\
    \vdots\\
    1_{|\Lambda|}
  \end{bmatrix}^\top )^\top} 
  -2\cdot (P-D)\cdot C_a^\top \right) \cdot\frac{1}{2\cdot sd_p^2}\right) 
\end{dmath*}

\[
  f = 1/2\cdot \mathrm{tr}(B^\top \cdot Ginv\cdot B)+1/(2\cdot sdl2)\cdot \|image-\exp(((P-\exp((P^{2}\cdot oneCOL2\cdot oneROWKg^\top +(Cb^{2}\cdot oneCOL2\cdot oneROWL^\top )^\top -2\cdot P\cdot Cb^\top )/(2\cdot sdg2))\cdot B)^{2}\cdot oneCOL2\cdot oneROWKp^\top +(Ca^{2}\cdot oneCOL2\cdot oneROWL^\top )^\top -2\cdot (P-\exp((P^{2}\cdot oneCOL2\cdot oneROWKg^\top +(Cb^{2}\cdot oneCOL2\cdot oneROWL^\top )^\top -2\cdot P\cdot Cb^\top )/(2\cdot sdg2))\cdot B)\cdot Ca^\top )/(2\cdot sdp2))\cdot A\|_2^{2}
\]

gradient:
\[
  \frac{\partial f}{\partial B} = Ginv\cdot B-(1/(sdp2\cdot sdl2)\cdot \exp(1/(2\cdot sdg2)\cdot (oneROWKg\cdot (P^{2}\cdot oneCOL2)^\top +Cb^{2}\cdot oneCOL2\cdot oneROWL^\top -2\cdot Cb\cdot P^\top ))\cdot \mathrm{diag}(image-\exp(1/(2\cdot sdp2)\cdot ((P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)^{2}\cdot oneCOL2\cdot oneROWKp^\top +oneROWL\cdot (Ca^{2}\cdot oneCOL2)^\top -2\cdot (P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)\cdot Ca^\top ))\cdot A)\cdot \exp(1/(2\cdot sdp2)\cdot ((P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)^{2}\cdot oneCOL2\cdot oneROWKp^\top +oneROWL\cdot (Ca^{2}\cdot oneCOL2)^\top -2\cdot (P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)\cdot Ca^\top ))\cdot \mathrm{diag}(A)\cdot Ca-1/(sdp2\cdot sdl2)\cdot \exp(1/(2\cdot sdg2)\cdot (oneROWKg\cdot (P^{2}\cdot oneCOL2)^\top +Cb^{2}\cdot oneCOL2\cdot oneROWL^\top -2\cdot Cb\cdot P^\top ))\cdot \mathrm{diag}((image-\exp(1/(2\cdot sdp2)\cdot ((P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)^{2}\cdot oneCOL2\cdot oneROWKp^\top +oneROWL\cdot (Ca^{2}\cdot oneCOL2)^\top -2\cdot (P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)\cdot Ca^\top ))\cdot A)\odot (\exp(1/(2\cdot sdp2)\cdot ((P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)^{2}\cdot oneCOL2\cdot oneROWKp^\top +oneROWL\cdot (Ca^{2}\cdot oneCOL2)^\top -2\cdot (P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)\cdot Ca^\top ))\cdot (A\odot oneROWKp)))\cdot (P-\exp(1/(2\cdot sdg2)\cdot (P^{2}\cdot oneCOL2\cdot oneROWKg^\top +oneROWL\cdot (Cb^{2}\cdot oneCOL2)^\top -2\cdot P\cdot Cb^\top ))\cdot B)\cdot \mathrm{diag}(oneCOL2))
\]
where
\begin{itemize}
  \item $A$ is a vector
  \item $B$ is a matrix
  \item $Ca$ is a matrix
  \item $Cb$ is a matrix
  \item $Ginv$ is a symmetric matrix
  \item $P$ is a matrix
  \item $image$ is a vector
  \item $oneCOL2$ is a vector
  \item $oneROWKg$ is a vector
  \item $oneROWKp$ is a vector
  \item $oneROWL$ is a vector
  \item $sdg2$ is a scalar
  \item $sdl2$ is a scalar
  \item $sdp2$ is a scalar
\end{itemize}
\end{document}
